/*

 Copyright (C) 2009-2012. David Thevenin, ViniSketch SARL (c), and 
 contributors. All rights reserved

 This program is free software: you can redistribute it and/or modify
 it under the terms of the GNU Lesser General Public License as published
 by the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 GNU Lesser General Public License for more details.

 You should have received a copy of the GNU Lesser General Public License
 along with this program. If not, see <http://www.gnu.org/licenses/>.
*/
(function(m,A){function q(){return"hak_id_"+(new Date).getTime()+""+Math.floor(Math.random()*1E6)}function o(a){this.constructor=j.Object;this._id=f.isString(a)?a:a&&a.id?a.id:q();if(a)this.__config__=f.clone(a)}function F(a,b){var c={},d,e,g,h;for(h in b){d=b[h];if(f.isNumber(d)){e={};g="_"+h;if(d&n.core.Object.PROPERTY_IN)e.set=function(a){return function(b){this[a]=b;this.propertyChange(a)}}(g);if(d&n.core.Object.PROPERTY_OUT)e.get=function(a){return function(){return this[a]}}(g)}else if(f.isString(d)){g=
G.exec(d);if(!g||g.length!=3)throw"Unvalid property path: "+d;e={};e.set=function(a,b){return function(c){this[a][b]=c;this.propertyChange(b)}}(g[1],g[2]);e.get=function(a,b){return function(){return this[a][b]}}(g[1],g[2])}else typeof d=="object"&&(e=d);c[h]=e}f.defineClassProperties(a,c)}function v(a){this.parent=j.Object;this.parent(a);this.constructor=n.core.Model;this.__bindings__={}}function B(a,b,c,d){this.spec=a;this.obj=b;this.delay=FORCE_EVENT_PROPAGATION_DELAY?!0:d;f.isFunction(c)?this.func_ptr=
c:this.func=c}function r(a){this.parent=j.Object;this.parent(a);this.constructor=j.EventSource;this.__bindings__={};this.__node_binds__={}}function C(){this.dataflow_node=[];this.dataflow_edges={};this.is_propagating=!1;this._node_link={};this.__shouldnt_propagate__=0}function l(a){this.parent=j.Object;this.parent(a);this.constructor=l}function w(){this.parent=j.Object;this.parent();this.constructor=w;this._tasksAndParams=[];arguments.length&&this.setTasks(arguments)}function x(){this.parent=j.Object;
this.parent();this.constructor=x;this._tasksAndParams=[];arguments.length&&this.setTasks(arguments)}function s(a){this.parent=j.Object;this.parent();this.constructor=s;this.time=a}function i(){this.deviceId=this.orientation=null;this.targets={};this.os=i.OS_UNKNOWN;this.screenResolution=i.SR_UNKNOWN;this.screenRatio=0}function y(a){this.parent=n.core.Model;this.parent(a);this.constructor=n.core.Array}function t(a){this.parent=j.EventSource;this.parent(a);this.constructor=n.core.DataStorage;this.__models__=
{}}function D(a){this.parent=t;this.parent(a);this.constructor=n.core.LocalStorage}var E=m.document,n=m.vs,f=n.util,j=n.core;j.createId=q;o.prototype={_id:"",__i__:!1,__config__:null,init:function(){if(this.__i__)return this;if(!this._id)this._id=q();o._obs[this._id]=this;this.initComponent();this.__i__=!0;this.__config__&&(this.configure(this.__config__),delete this.__config__);return this},initComponent:function(){},createId:function(){console.warn("this.createId is deprecated, Use the static method vs.core.createId instead");
return q()},configure:function(a){if(typeof a==="object"){var b,c,d,e=!1,g=p[this._id];g&&g.pausePropagation();if(a instanceof v)if((b=this.getPropertyDescriptor("model"))&&b.set)this.model=a,e=!0;else{b=a.getProperties();for(d=0;d<b.length;d++)c=b[d],c!=="id"&&(this[c]=a[c],e=!0)}else if(a)for(c in a)c==="id"||c==="node"||c==="nodeRef"||c==="view"||(this[c]=a[c],e=!0);g?(g.restartPropagation(),e&&(this.propertiesDidChange&&this.propertiesDidChange(),g.propagate(this._id))):e&&this.propertiesDidChange&&
this.propertiesDidChange()}},getProperties:function(){if(!this.constructor._properties_)return[];return this.constructor._properties_.slice()},toJSON:function(){return this._toJSON("{")+"}"},parseJSON:function(a){try{var b=a&&f.parseJSON(a)||{},c;for(c in b)this["_"+c]=void 0}catch(d){console.error("vs.core.Object.parseJSON failed. "+d.toString())}},_toJSON:function(a){var b,c,d,e=this.constructor._properties_,g=0;if(!e)return a;for(var h=0;h<e.length;h++)if(b=e[h],c=this["_"+b],typeof c!="undefined"){if(c==
null)d="null";else if(c instanceof Date)d='"/Date('+c.getTime()+')/"';else if(c.toJSON)d=c.toJSON();else try{d=JSON.stringify(c)}catch(f){console.warn(f);continue}g++&&(a+=",");a+='"'+b+'":'+d}return a},destructor:function(){},propertyChange:function(a){var b=p[this._id];b&&b.propagate(this._id,a)},propagateChange:function(a){this.propertyChange(a)},clone:function(a,b){var c,d,e,g,h;b||(b={});if(b[this])return b[this];a||(a={});if(!a.id)a.id=q();if(f.isFunction(this.constructor))c=new this.constructor(a);
else return console.warn("impossible to clone this object."),null;b[this]=c;for(d in this)d=="id"||d=="_id"||(e=this[d],g=Object.getOwnPropertyDescriptor(this,d),h=Object.getOwnPropertyDescriptor(c,d),g&&(g.get||g.set)?h||f.defineProperty(c,d,g):this.hasOwnProperty(d)&&(c[d]=e instanceof n.core.Object?e.clone(null,b):f.isArray(e)?e.slice():e));c.__i__=!1;return c},getOwnPropertyDescriptor:function(a){var b=Object.getPrototypeOf(this);if(!b)return null;return Object.getOwnPropertyDescriptor(b,a)},
getPropertyDescriptor:function(a){function b(a,d){if(!a)return null;var e=Object.getPrototypeOf(a);if(!e)return null;var g=Object.getOwnPropertyDescriptor(e,d);if(g)return g;return b(e,d)}return b(this,a)},_super:function(){var a=this._super.caller._super_func_;a&&a.apply(this,arguments)}};f.defineClassProperty(o,"id",{get:function(){return this._id}});o._obs={};j.Object=o;var H=m.Object.prototype.constructor;n.core.Object.PROPERTY_IN=1;n.core.Object.PROPERTY_OUT=2;n.core.Object.PROPERTY_IN_OUT=3;
var G=/(\w+[.\w+]*)#(\w+)/;j.createClass=function(a){var b=null,c={},d=n.core.Object,e={},b=function(){this.parent=b.__spec.parent;b.__spec&&b.__spec._constructor?b.__spec._constructor.apply(this,arguments):b.__spec&&b.__spec.parent&&this.parent.apply(this,arguments);this.constructor=b};if(a&&a.parent)d=a.parent,delete a.parent;if(a&&a.properties)e=a.properties,delete a.properties;c.parent=d;if(a&&a.constructor&&a.constructor!==H)c._constructor=a.constructor,c._constructor._super_func_=d;b.__spec=
c;if(a)b.prototype=a,a.constructor=b;d.prototype&&f.extendClass(b,d);if(a)for(key in a)if(a.hasOwnProperty(key)){var c=a[key],g=d.prototype[key];if(f.isFunction(c)&&f.isFunction(g))c._super_func_=g}F(b,e);return b};v.prototype={__bindings__:null,__should_propagate_changes__:!0,_sync_service_:null,destructor:function(){function a(a){if(a)for(var b;0<a.length;)b=a[0],f.free(b)}j.Object.prototype.destructor.call(this);this._sync_service_&&this._sync_service_.removeModel(this);for(var b in this.__bindings__)a(this.__bindings__[b]),
delete this.__bindings__[b];delete this.__bindings__},bindChange:function(a,b,c){b&&(a=a||"change",c=new B(a,b,c,!1),b=this.__bindings__[a],b||(b=[],this.__bindings__[a]=b),b.push(c))},unbindChange:function(a,b,c){a||(a="change");(function(d){if(d)for(var e,g=0;g<d.length;)e=d[g],e.spec===a?e.obj===b?f.isString(c)||f.isFunction(c)?e.func===c||e.func_ptr===c?(d.remove(g),f.free(e)):g++:(d.remove(g),f.free(e)):g++:g++})(this.__bindings__[a])},stopPropagation:function(){this.__should_propagate_changes__=
!1},hasToPropagateChange:function(){return this.__should_propagate_changes__},change:function(a){var b;this.__should_propagate_changes__=!0;b=new z(this,a||"change:"+a);try{var c=function(a){if(a)for(var c=a.length,d;c--;)if(d=a[c],d.func_ptr)d.func_ptr.call(d.obj,b);else if(d.func)d.obj[d.func](b);else d.obj.notify(b)};a&&a!="change"&&c(this.__bindings__[a]);c(this.__bindings__.change)}catch(d){console.error(d)}},propertyChange:function(a){var b=p[this._id];b&&(b.propagate(this._id,a),this.__should_propagate_changes__&&
this.change())}};f.extendClass(v,j.Object);j.Model=v;FORCE_EVENT_PROPAGATION_DELAY=!1;EVENT_SUPPORT_TOUCH="createTouch"in E;if(!EVENT_SUPPORT_TOUCH&&(m.navigator.userAgent.indexOf("Android")!==-1||m.navigator.userAgent.indexOf("BlackBerry")!==-1))EVENT_SUPPORT_TOUCH=!0;EVENT_SUPPORT_TOUCH?(j.POINTER_START="touchstart",j.POINTER_MOVE="touchmove",j.POINTER_END="touchend",j.POINTER_CANCEL="touchcancel"):(j.POINTER_START="mousedown",j.POINTER_MOVE="mousemove",j.POINTER_END="mouseup",j.POINTER_CANCEL=
"mouseup");var z=function(a,b,c){this.srcTarget=this.src=a;this.type=b;this.data=c};z.prototype={src:null,srcTarget:null,type:"",data:null,destructor:function(){delete this.src;delete this.srcTarget;delete this.type;delete this.data}};j.Event=z;j.FORCE_EVENT_PROPAGATION_DELAY=FORCE_EVENT_PROPAGATION_DELAY;j.EVENT_SUPPORT_TOUCH=EVENT_SUPPORT_TOUCH;B.prototype.destructor=function(){delete this.spec;delete this.obj;delete this.delay;delete this.func_ptr;delete this.func};r.prototype={__bindings__:null,
__node_binds__:null,destructor:function(){var a,b,c;for(a in this.__bindings__)if(b=this.__bindings__[a]){for(;b.length;)c=b.pop(),f.free(c);delete this.__bindings__[a]}delete this.__bindings__;for(a in this.__node_binds__)if(c=this.__node_binds__[a],typeof c==="undefined")console.warn("vs.core.Object.destructor, no bind <"+a+" exists.");else for(b=0;b<c.length;b++)data=c[b],data.n.removeEventListener(event,data.h);delete this.__node_binds__},clone:function(a,b){var c=o.prototype.clone.call(this,
a,b);c.__bindings__={};c.__node_binds__={};return c},bind:function(a,b,c,d){if(a&&b)return b=new B(a,b,c,d),c=this.__bindings__[a],c||(c=[],this.__bindings__[a]=c),c.push(b),b},unbind:function(a,b,c){var d=this.__bindings__[a],e=0,g;if(d)for(;e<d.length;)g=d[e],g.spec===a?g.obj===b?f.isString(c)||f.isFunction(c)?g.func===c||g.func_ptr===c?(d.remove(e),f.free(g)):e++:(d.remove(e),f.free(g)):e++:e++},propagate:function(a,b,c,d){var e=this.__bindings__[a],g,h,f;if(e){g=new z(this,a,b);if(c)g.srcTarget=
c;a=e.length;try{for(f=function(){if(h.func_ptr)h.func_ptr.call(h.obj,g);else if(h.func)h.obj[h.func](g);else h.obj.notify(g)};a--;)h=e[a],d||h.delay?m.setTimeout(f,0):f.call(this)}catch(i){console.error(i)}}else this.__parent&&(c||(c=this),this.__parent.propagate(a,b,c))},notify:function(a){this.propagate(a.type,a.data)},nodeBind:function(a,b,c,d){if(a&&f.isString(b)){var e=this,g=null,h=null,i,j;if(typeof c==="undefined")c="notify";else if(f.isString(c)){if(!f.isFunction(this[c])){console.warn("vs.core.Object.nodeBind, unknown function named: "+
c);return}}else if(f.isFunction(c))g=c,c=g.name;else{console.error("vs.core.Object.nodeBind, invalid func parameter");return}h=!d||d===k.ANY_MASK?function(a){try{a.src=a.currentTarget,a.data=a,g||(g=e[c]),g.call(e,a)}catch(b){console.error(b)}}:function(a){a.stopPropagation();try{if(d||!a.altKey&&!a.ctrlKey&&!a.shiftKey&&!a.metaKey)if(d!==k.ALT||a.altKey)if(d!==k.CTRL||a.ctrlKey)if(d!==k.SHIFT||a.shiftKey)if(d!==k.META||a.metaKey)a.src=a.currentTarget,a.data=a,g||(g=e[c]),g.call(e,a)}catch(b){console.error(b)}};
j=b+c;this.__node_binds__?(i=this.__node_binds__[j],typeof i==="undefined"&&(i=[],this.__node_binds__[j]=i),i.push({n:a,h:h}),a.addEventListener(b,h,!1)):console.error("nodeBind impossible")}},nodeUnbind:function(a,b,c){if(a&&f.isString(b)){var d=null,e;if(typeof c==="undefined")c="notify";else if(f.isString(c)){if(!f.isFunction(this[c])){console.warn("vs.core.Object.nodeUnbind, unknown function named: "+c);return}}else if(f.isFunction(c))c=c.name;else{console.error("vs.core.Object.nodeBind, invalid func parameter");
return}d=this.__node_binds__[b+c];if(typeof d==="undefined")console.warn("vs.core.Object.nodeUnbind, no bind <"+b+","+c+" exists.");else{for(c=0;c<d.length;)e=d[c],e.n===a?(a.removeEventListener(b,e.h),d.remove(c)):c++;a._object_=A}}}};f.extendClass(r,o);j.EventSource=r;var k=new r("__KEYBOARD__");k._handler_set_down=!1;k._handler_set_up=!1;k.managePrevent=function(a,b){var c=this.__bindings__[a],d,e;if(c)for(d=0;d<c.length;d++)if(e=c[d],e.prevent){b.preventDefault();break}};k.KEY_UP=1E3;k.ESC=27;
k.ENTER=13;k.SPACE=32;k.BACKSPACE=8;k.SHIFT=16;k.CTRL=17;k.ALT=18;k.NUMLOCK=144;k.LEFT_ARROW=37;k.UP_ARROW=38;k.RIGHT_ARROW=39;k.DOWN_ARROW=40;k.L=76;k.S=83;k.Z=90;k.META=2E3;k.ANY_MASK=3E3;k.UNDO=256;k.REDO=257;k.SAVE=258;j.KEYBOARD=k;j.KEYBOARD.bind=function(a,b,c,d){var b=r.prototype.bind.call(this,a,b,c),e=this;if(d)b.prevent=!0;if(a>k.KEY_UP){if(!this._handler_set_up)E.documentElement.addEventListener("keyup",function(a){e.managePrevent(a.keyCode,a);e.propagate(a.keyCode+k.KEY_UP,a)},!1),this._handler_set_up=
!0}else if(!this._handler_set_down)E.documentElement.addEventListener("keydown",function(a){(a.ctrlKey||a.metaKey)&&!a.shiftKey&&a.keyCode===k.Z?(e.propagate(k.UNDO),a.preventDefault()):(a.ctrlKey||a.metaKey)&&a.shiftKey&&a.keyCode===k.Z?(e.propagate(k.REDO),a.preventDefault()):(a.ctrlKey||a.metaKey)&&!a.shiftKey&&a.keyCode===k.S?(e.propagate(k.SAVE),a.preventDefault()):(a.ctrlKey||a.metaKey)&&!a.shiftKey&&a.keyCode?(e.managePrevent(k.META+a.keyCode,a),e.propagate(k.META+a.keyCode)):(e.managePrevent(a.keyCode,
a),e.propagate(a.keyCode,a))},!1),this._handler_set_down=!0};var u=function(a){this.parent=j.EventSource;this.parent(q());this.constructor=u;this.owner=a;this._list_of_state={};this._list_input=[];this._list_output=[];this._current_state=this._initial_state="";this._inputs={};this._output_action={}};u.prototype={destructor:function(){delete this._list_of_state;this.owner=A;delete this._list_of_state;delete this._list_input;delete this._list_output;delete this._inputs;delete this._output_action},clone:function(a,
b){var c=j.EventSource.prototype.clone.call(this,null,b);c.owner=a;c._current_state="";c._inputs={};c._output_action={};return c},initWithData:function(a,b,c,d){if(a&&b&&c&&d){for(var e=0;e<a.length;e++)this.addState(a[e]);for(e=0;e<b.length;e++)this.addInput(b[e]);for(e=0;e<c.length;e++)this.addOutput(c[e]);for(e=0;e<d.length;e++)this.addTransition(d[e].from,d[e].to,d[e].on,d[e].output)}},initWithMatrix:function(a){for(var b=1;b<a[0].length;b++)this.addState(a[0][b]);for(b=1;b<a.length;b++)for(var c=
a[b][0],d=1;d<a[0].length;d++){var e=a[0][d],g=a[b][d];g&&(g=g.split("/"),g[0]&&this.addInput(g[0]),g[1]&&this.addOutput(g[1]),this.addTransition(c,e,g[0],g[1]))}},addInput:function(a){a&&!this.existInput(a)&&this._list_input.push(a)},getInputs:function(){return this._list_input.slice()},existInput:function(a){if(a)return this._list_input.findItem(a)>-1},addOutput:function(a){a&&!this.existOutput(a)&&this._list_output.push(a)},getOutputs:function(){return this._list_output.slice()},existOutput:function(a){if(a)return this._list_output.findItem(a)>
-1},addState:function(a){if(!a||this.existState(a))return!1;this._list_of_state[a]={transitionEvents:{}};return!0},removeState:function(a){if(!a||!this.existState(a))return!1;delete this._list_of_state[a];return!0},renameState:function(a,b){if(!a||!this.existState(a))return!1;if(!b||this.existState(b))return!1;this._list_of_state[b]=this._list_of_state[a];delete this._list_of_state[a];if(this._initial_state===a)this._initial_state=b;for(var c in this._list_of_state){var d=this._list_of_state[c];if(d!==
null)for(var e in d.transitionEvents){var g=d.transitionEvents[e];if(g.to===a)g.to=b}}return!0},getListState:function(){var a=[],b;for(b in this._list_of_state)a.push(b);return a},existState:function(a){if(!a)return!1;if(this._list_of_state[a])return!0;return!1},addTransition:function(a,b,c,d){a&&this.existState(a)&&b&&this.existState(b)&&c&&this.existInput(c)&&(this._list_of_state[a].transitionEvents[c]={on:c,to:b,output:d})},removeTransitionFrom:function(a,b){if(a&&this.existState(a)&&b&&this.existInput(b)){var c=
this._list_of_state[a];c.transitionEvents[b]&&delete c.transitionEvents[b]}},removeTransitionTo:function(a,b){if(a&&this.existState(a)&&b&&this.existInput(b))for(var c in this._list_of_state){var d=this._list_of_state[c],e=d.transitionEvents[b];e&&e.to===a&&delete d.transitionEvents[b]}},getTransionsToState:function(a){if(this.existState(a)){var b=[],c;for(c in this._list_of_state){var d=this._list_of_state[c];if(d!==null)for(var e in d.transitionEvents){var g=d.transitionEvents[e];if(g.to===a)g=
f.clone(g),g.from=c,b.push(g)}}return b}},getTransionsFromState:function(a){if(this.existState(a)){var b=[],c=this._list_of_state[a];if(c===null)return null;for(var d in c.transitionEvents){var e=f.clone(c.transitionEvents[d]);e.from=a;b.push(e)}return b}},switchStates:function(a,b){if(a!==b&&this.existState(a)&&this.existState(b)){for(var c=this.getTransionsToState(a),d=this.getTransionsFromState(a),e=this.getTransionsToState(b),g=this.getTransionsFromState(b),h=0;h<c.length;){var f=c[h];f.from===
b?c.remove(f):h++}for(h=0;h<d.length;)f=d[h],f.to===b?d.remove(f):h++;for(h=0;h<c.length;h++)f=c[h],this.removeTransitionFrom(f.from,f.on);for(h=0;h<d.length;h++)f=d[h],this.removeTransitionFrom(f.from,f.on);for(h=0;h<e.length;h++)f=e[h],this.removeTransitionFrom(f.from,f.on);for(h=0;h<g.length;h++)f=g[h],this.removeTransitionFrom(f.from,f.on);for(h=0;h<c.length;h++){var f=c[h],i=f.from===b?a:f.from;this.addTransition(i,b,f.on,f.output)}for(h=0;h<d.length;h++)f=d[h],c=f.from===b?a:f.to,this.addTransition(b,
c,f.on,f.output);for(h=0;h<e.length;h++)f=e[h],i=f.from===a?b:f.from,this.addTransition(i,a,f.on,f.output);for(h=0;h<g.length;h++)f=g[h],c=f.to===a?b:f.to,this.addTransition(a,c,f.on,f.output);if(this._initial_state===a)this._initial_state=b;else if(this._initial_state===b)this._initial_state=a}},setInput:function(a,b,c){if(a&&b&&c){if(b.bind)b.bind(c,this);else if(b.addEventListener)this.nodeBind(b,c);else return;var d=this._inputs[b];d||(d=[],this._inputs[b]=d);d.push([c,a,b])}},setOutput:function(a,
b){a&&b&&(this._output_action[a]=b)},activate:function(){if(!this._initial_state||!this._list_of_state[this._initial_state])return!1;this.goTo(this._initial_state);return!0},goTo:function(a,b,c){if(!this.existState(a))return!1;this._current_state=a;if(b&&this._output_action[b])if(a=this._output_action[b],a instanceof Function)a.call(this.owner,c);else if(f.isString(a))this.owner[this._output_action[b]](c);return!0},clear:function(){this._list_of_state={};delete this._list_input;delete this._list_output;
this._list_input=[];this._list_output=[];this._initial_state="";for(var a in this._inputs)for(var b=this._inputs[a],c=0;c<b.length;c++){var d=b[c][2],e=b[c][0];d.bind?d.unbind(e,this):d.addEventListener&&this.nodeUnbind(d,e)}this._current_state=""},notify:function(a){var b=this._inputs[a.src];if(b)for(var c=0;c<b.length;c++)a.type===b[c][0]&&this._list_of_state[this._current_state]&&this.fsmNotify(b[c][1],a.data)},fsmNotify:function(a,b,c){if(this._list_of_state[this._current_state]){var d=this._list_of_state[this._current_state].transitionEvents[a];
if(!d)return!1;this.goTo(d.to,d.output,{on:a,data:b},c);return!0}}};f.extendClass(u,r);f.defineClassProperty(u,"initialState",{set:function(a){if(a){if(this.existState(a))this._initial_state=a}else this._initial_state=A},get:function(){return this._initial_state}});j.Fsm=u;C.prototype={propagate_values:function(a){var b=this.dataflow_edges[a],c,d,e,g,h,i;if(b){d=o._obs[a];for(a=0;a<b.length;a++)if(h=o._obs[b[a][0]])if(i=b[a][2]){for(c=0;c<i.length;c++){e=i[c][0];g=i[c][1];var j=d.getPropertyDescriptor(e),
k=h.getPropertyDescriptor(g);if(!j||!j.get)if(e="_"+f.underscore(e),!d.hasOwnProperty(e))continue;if(!k||!k.set)if(g="_"+f.underscore(g),!h.hasOwnProperty(g))continue;h[g]=d[e]}h.__should__call__has__changed__=!0}}},propagate:function(a){if(!this.is_propagating&&!this.__shouldnt_propagate__){this.is_propagating=!0;var b=0;if(a){for(;b<this.dataflow_node.length&&this.dataflow_node[b]!==a;)b++;b<this.dataflow_node.length-1&&(this.propagate_values(a),b++)}for(;b<this.dataflow_node.length;b++)if(a=o._obs[this.dataflow_node[b]]){if(a.__should__call__has__changed__&&
a.propertiesDidChange)a.propertiesDidChange(),a.__should__call__has__changed__=!1;this.propagate_values(a.id)}this.is_propagating=!1}},build:function(){if(this._ref_node&&this._ref_edges){var a=[],b,c,d,e,g,f;for(b=0;b<this._ref_node.length;b++)c=this._ref_node[b],this._node_link[c]&&a.push(this._node_link[c]);this.dataflow_node=a;a={};for(c in this._ref_edges)if(this._node_link[c]){d=this._ref_edges[c];e=[];for(b=0;b<d.length;b++)g=d[b],f=[3],this._node_link[g[0]]&&(f[0]=this._node_link[g[0]],f[1]=
g[1],f[2]=g[2].slice(),e.push(f));a[this._node_link[c]]=e}this.dataflow_edges=a}},register_ref_node:function(a){if(a)this._ref_node=a},register_ref_edges:function(a){if(a)this._ref_edges=a},pausePropagation:function(){this.__shouldnt_propagate__++},restartPropagation:function(){this.__shouldnt_propagate__--;if(this.__shouldnt_propagate__<0)this.__shouldnt_propagate__=0}};var p={};m._df_node_register=function(a,b,c){if(a&&b&&c&&(a=p[a]))a._node_link[b]=c,p[c]=a};m._df_create=function(a,b){var c=new C;
c.ref=b;return p[a]=c};m._df_register_ref_node=function(a,b){if(a&&b){var c=p[a];c&&c.register_ref_node(b)}};m._df_register_ref_edges=function(a,b){if(a&&b){var c=p[a];c&&c.register_ref_edges(b)}};m._df_build=function(a){a&&(a=p[a])&&a.build()};j.DataFlow=C;l.STARTED=1;l.STOPPED=0;l.PAUSED=2;l.prototype={delegate:null,_state:l.STOPPED,start:function(){},stop:function(){},pause:function(){}};f.extendClass(l,j.Object);f.defineClassProperty(l,"state",{get:function(){return this._state}});w.prototype=
{_tasksAndParams:null,_tasksWillEnded:null,setTasks:function(a){if(this._state!==l.STOPPED)return!1;var b,c,d,e;this._tasksAndParams=[];for(b=0;b<a.length;b++)if(c=a[b])d=e=null,f.isArray(c)?c.length===1?d=c[0]:c.length===2&&(d=c[0],e=c[1]):(d=c,e=null),d?!d.start||!d.stop||!d.pause?console.warn("Invalid task: "+d.toString()):this._tasksAndParams.push([d,e]):console.warn("Undefined task")},start:function(a){if(this._state===l.STARTED)return!1;this._tasksWillEnded=this._tasksAndParams.length;this._state=
l.STARTED;var b,c;for(c=0;c<this._tasksAndParams.length;c++)b=this._tasksAndParams[c],b[0].delegate=this,b[0].start(b[1]?b[1]:a);return!0},stop:function(){if(this._state===l.STOPPED)return!1;this._state=l.STOPPED;var a,b;for(b=0;b<this._tasksAndParams.length;b++)a=this._tasksAndParams[b],a[0].stop();return!0},pause:function(){if(this._state===l.PAUSED)return!1;this._state=l.PAUSED;var a,b;for(b=0;b<this._tasksAndParams.length;b++)a=this._tasksAndParams[b],a[0].pause();return!0},taskDidStop:function(){this._state=
l.STOPPED;this._tasksWillEnded--;this._tasksWillEnded===0&&this.delegate&&this.delegate.taskDidEnd&&this.delegate.taskDidEnd(this)},taskDidPause:function(){this._state=l.STOPPED;this._tasksWillEnded--;this._tasksWillEnded===0&&this.delegate&&this.delegate.taskDidEnd&&this.delegate.taskDidEnd(this)},taskDidEnd:function(){this._state=l.STOPPED;this._tasksWillEnded--;this._tasksWillEnded===0&&this.delegate&&this.delegate.taskDidEnd&&this.delegate.taskDidEnd(this)}};f.extendClass(w,j.Object);x.prototype=
{_tasksAndParams:null,_nextTaskToStart:0,_startParam:null,setTasks:function(a){if(this._state!==l.STOPPED)return!1;var b,c,d,e;this._tasksAndParams=[];for(b=0;b<a.length;b++)if(c=a[b])d=e=null,f.isArray(c)?c.length===1?d=c[0]:c.length===2&&(d=c[0],e=c[1]):(d=c,e=null),d?!d.start||!d.stop||!d.pause?console.warn("Invalid task: "+d.toString()):this._tasksAndParams.push([d,e]):console.warn("Undefined task")},start:function(a){if(this._state===l.STARTED)return!1;this._state=l.STARTED;this._startParam=
a;var b=this._tasksAndParams[this._nextTaskToStart];if(!b)return!1;this._nextTaskToStart++;b[0].delegate=this;b[0].start(b[1]?b[1]:a);return!0},stop:function(){if(this._state===l.STOPPED)return!1;this._state=l.STOPPED;var a=this._tasksAndParams[this._nextTaskToStart-1];if(!a)return!1;this._nextTaskToStart=0;a[0].stop();return!0},pause:function(){if(this._state===l.PAUSED)return!1;this._state=l.PAUSED;var a=this._tasksAndParams[this._nextTaskToStart-1];if(!a)return!1;a[0].pause();return!0},taskDidStop:function(){this._state=
l.STOPPED;this._nextTaskToStart===0&&(this._nextTaskToStart-=1);this.delegate&&this.delegate.taskDidStop&&this.delegate.taskDidStop(this)},taskDidPause:function(){this._state=l.PAUSED;this._nextTaskToStart-=1;this.delegate&&this.delegate.taskDidPause&&this.delegate.taskDidPause(this)},taskDidEnd:function(){this._state=l.STOPPED;this._nextTaskToStart<this._tasksAndParams.length?this.start(this._startParam):(this._nextTaskToStart=0,this.delegate&&this.delegate.taskDidEnd&&this.delegate.taskDidEnd(this))}};
f.extendClass(x,j.Object);s.prototype={_time:0,_left_time:0,_timer:null,_start_time:0,start:function(){var a=this,b=this._time;if(this._state===l.STARTED)return!1;this._state===l.PAUSED?b=this._left_time:this._left_time=b;this._state=l.STARTED;this._start_time=(new Date).getTime();a=this;this._timer=setTimeout(function(){a._state=l.STOPPED;a.delegate&&a.delegate.taskDidEnd&&a.delegate.taskDidEnd(a)},b);return!0},stop:function(){if(this._state===l.STOPPED)return!1;this._state=l.STOPPED;clearTimeout(this._timer);
this._timer=null;this._left_time=this._time;this.delegate&&this.delegate.taskDidStop&&this.delegate.taskDidStop(this);return!0},pause:function(){if(this._state===l.PAUSED)return!1;this._state=l.PAUSED;this._left_time=this._left_time-(new Date).getTime()+this._start_time;this.delegate&&this.delegate.taskDidPause&&this.delegate.taskDidPause(this);return!0}};f.extendClass(s,j.Object);f.defineClassProperty(s,"state",{set:function(a){if(f.isNumber(a))this._time=a}});f.extend(j,{Task:l,Task_PAR:w,Task_SEQ:x,
TaskWait:s});i.OS_UNKNOWN=0;i.OS_WINDOWS=1;i.OS_MACOS=2;i.OS_LINUX=4;i.OS_IOS=5;i.OS_WP7=6;i.OS_BLACK_BERRY=7;i.OS_SYMBIAN=8;i.OS_ANDROID=9;i.OS_MEEGO=10;i.SR_UNKNOWN=0;i.SR_QVGA=1;i.SR_WQVGA=2;i.SR_HVGA=4;i.SR_VGA=5;i.SR_WVGA=6;i.SR_FWVGA=7;i.SR_SVGA=8;i.SR_XGA=9;i.SR_N_HD=10;i.SR_Q_HD=11;i.SR_WXGA=12;i.prototype={getOrientation:function(){return this.orientation},setDeviceId:function(a){if(f.isString(a))if(this.deviceId=a,a.indexOf("wp7")!=-1)this.os=i.OS_WP7,this.screenResolution=i.SR_WVGA,this.screenRatio=
1.6;else if(a.indexOf("iphone")!=-1)this.os=i.OS_IOS,this.screenResolution=i.SR_HVGA,this.screenRatio=1.5;else if(a.indexOf("ipad")!=-1)this.os=i.OS_IOS,this.screenResolution=i.SR_XGA,this.screenRatio=4/3;else if(a.indexOf("nokia_s3")!=-1)this.os=i.OS_SYMBIAN,this.screenResolution=i.SR_N_HD,this.screenRatio=4/3;else if(a.indexOf("android")!=-1){this.os=i.OS_ANDROID;if(a.indexOf("_3_2")!=-1)this.screenRatio=1.5;else if(a.indexOf("_16_10")!=-1)this.screenRatio=1.6;else if(a.indexOf("_16_9")!=-1)this.screenRatio=
16/9;var a=m.screen.width,b=m.screen.height;if(a>b)a=m.screen.height,b=m.screen.width;this.screenResolution=i._getScreenResolutionCode(a,b)}else if(a.indexOf("blackberry")!=-1){this.os=i.OS_BLACK_BERRY;if(a.indexOf("_4_3"))this.screenRatio=4/3;else if(a.indexOf("_3_2"))this.screenRatio=1.5;else if(a.indexOf("_16_10"))this.screenRatio=1.6;a=m.screen.width;b=m.screen.height;this.screenResolution=i._getScreenResolutionCode(a,b)}},setOrientation:function(a,b){var c,d,e;e=m.innerWidth;var f=m.innerHeight,
h;if(this.orientation!==a){e>f&&(h=f,f=e,e=h);for(d in j.Object._obs)if(e=j.Object._obs[d])e._orientationWillChange&&e._orientationWillChange(a),e.orientationWillChange&&e.orientationWillChange(a);for(c in this.targets)if(d=this.targets[c],d.device===this.deviceId&&(!(a!==0&&a!==180||c.indexOf("_p")===-1)||!(a!==90&&a!==-90||c.indexOf("_l")===-1)))return this.setActiveStyleSheet(c),this.orientation=a,d=function(){var b,c;for(b in j.Object._obs)(c=j.Object._obs[b])&&c.orientationDidChange&&c.orientationDidChange(a)},
b?d.call(this):setTimeout(d,100),c}},setActiveStyleSheet:function(a){f.setActiveStyleSheet(a);m._current_platform_id=a},registerTargetId:function(a,b){this.targets[a]=b}};i._getScreenResolutionCode=function(a,b){if(a===240&&b===320)return i.SR_QVGA;if(a===240&&b===400)return i.SR_WQVGA;if(a===320&&b===480)return i.SR_HVGA;if(a===480&&b===640)return i.SR_VGA;if(a===480&&b===800)return i.SR_WVGA;if(a===320&&b===854)return i.SR_WFVGA;if(a===600&&b===800)return i.SR_SVGA;if(a===768&&b===1024)return i.SR_XGA;
if(a===360&&b===640)return i.SR_N_HD;if(a===540&&b===960)return i.SR_Q_HD;if(a===800&&b===1280)return i.SR_WXGA};i._estimateScreenSize=function(a){var b=a.width/a.xdpi,a=a.height/a.ydpi,b=Math.sqrt(b*b+a*a);if(b<5)return 3;return b<8?7:10};if(typeof m.deviceConfiguration=="undefined")m.deviceConfiguration=new i;j.DeviceConfiguration=i;HTTPRequest=function(a){this.parent=j.EventSource;this.parent(a);this.constructor=HTTPRequest};HTTPRequest.prototype={_url:"",_method:"GET",_login:"",_password:"",_content_type:"",
send:function(a){var b=new XMLHttpRequest;this._response_xml=this._response_text=null;b.open(this._method,this._url,!0,this._login||null,this._password||null);b.setRequestHeader("Cache-Control","no-cache");b.setRequestHeader("Pragma","no-cache");this._content_type&&b.setRequestHeader("Content-Type",this._content_type);var c=this;b.onreadystatechange=function(){if(b.readyState===4)if(b.status===200)if(b.responseText)c._response_text=b.responseText,c._response_xml=b.responseXML,c.propagateChange(),
c.propagate("textload",this._response_text),c.propagate("xmlload",this._response_xml);else return c.propagate("loaderror","file not found."),!1;else return c.propagate("loaderror",b.status),!1};b.send(a)}};f.extendClass(HTTPRequest,j.EventSource);f.defineClassProperties(HTTPRequest,{url:{set:function(a){if(f.isString(a))this._url=a}},method:{set:function(a){if(!(a!="GET"||a!="POST"))this._method=a}},login:{set:function(a){if(f.isString(a))this._login=a}},password:{set:function(a){if(f.isString(a))this._password=
a}},contentType:{set:function(a){if(f.isString(a))this._content_type=a}},responseText:{get:function(){return this._response_text}},responseXML:{get:function(){return this._response_xml}}});j.HTTPRequest=HTTPRequest;y.prototype={_data:null,_model_class:null,initComponent:function(){this._data=[]},item:function(a){return this._data[a]},_instanciateModel:function(a){if(a instanceof n.core.Model)return a;if(a instanceof Object&&this._model_class)try{var b=new this._model_class(a);b.init();return b}catch(c){console.error(c.toString())}return a},
add:function(){for(var a=[],b=0;b<arguments.length;b++)a.push(this._instanciateModel(arguments[b]));this._data.push.apply(this._data,a);this.hasToPropagateChange()&&this.change("add");return this.length},addAtIndex:function(){if(!(arguments.length<2)){for(var a=[],b=1;b<arguments.length;b++)a.push(this._instanciateModel(arguments[b]));this._data.splice.apply(this._data,a);this.hasToPropagateChange()&&this.change("add",a[0],a.length-2)}},remove:function(a,b){this._data.remove(a,b);this.hasToPropagateChange()&&
this.change("remove",a,b)},removeAll:function(){this._data=[];this.hasToPropagateChange()&&this.change("removeall")},indexOf:function(){throw"method not yet implemented";},toJSON:function(){var a=this._toJSON("{"),b=0,c;for(a+=', "data": [';b<this._data.length;b++)if(c=this._data[b])a+=c.toJSON?c.toJSON():JSON.stringify(c),b<this._data.length-1&&(a+=",");a+="]}";return a},parseJSON:function(a){try{var b=a&&f.parseJSON(a)||{},c,d,e,g;for(d in b)if(this._data=[],d=="data")for(c=0;c<b.data.length;c++)if(g=
b.data[c],this._model_class){e=new this._model_class;e.init();for(d in g)e["_"+d]=g[d];this.add(e)}else this.add(g);else this["_"+d]=b[d]}catch(h){console.error("vs.core.Array.parseJSON failed. "+h.toString())}}};f.extendClass(y,j.Model);f.defineClassProperties(y,{length:{get:function(){if(!this.__i__)throw"Component not initialized";return this._data.length}},modelClass:{set:function(a){if(a instanceof Function)this._model_class=a}}});j.Array=y;t.prototype={__models__:null,registerModel:function(a,
b){if(a&&b)this.__models__[a]&&error.log("Model with the name already registered."),this.__models__[a]=b,b._sync_service_=this},removeModel:function(a){a&&this.__models__[a]&&delete this.__models__[a]},save:function(){},load:function(){}};f.extendClass(t,j.EventSource);j.DataStorage=t;D.prototype={save:function(a){function b(a){var b,f=c.__models__[a];if(f){try{b=f.toJSON?f.toJSON():JSON.stringify(f)}catch(h){error.log(h),c.propagate("error",h)}localStorage.setItem(a,b)}}var c=this;if(a)b(a);else for(a in this.__models__)b(a);
c.propagate("save")},load:function(a){function b(a){try{var b=c.__models__[a];if(b){var f=localStorage.getItem(a);b.parseJSON(f)}}catch(h){console.error("LocalStorate.load failed. "+h.toString())}}var c=this;if(a)b(a);else for(a in this.__models__)b(a);c.propagate("load")}};f.extendClass(D,t);j.LocalStorage=D})(window);
