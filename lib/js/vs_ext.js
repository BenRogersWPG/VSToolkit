/*

 Copyright (C) 2009-2012. David Thevenin, ViniSketch SARL (c), and 
 contributors. All rights reserved

 This program is free software: you can redistribute it and/or modify
 it under the terms of the GNU Lesser General Public License as published
 by the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 GNU Lesser General Public License for more details.

 You should have received a copy of the GNU Lesser General Public License
 along with this program. If not, see <http://www.gnu.org/licenses/>.
*/
(function(n,m){function p(){b.InfoWindow=function(a,c,b,d,e){this.vs_map=a;this.id=c;this.type=b;this.setCoordinate(d,e);this.setValues({map:this.vs_map._gmap})};b.InfoWindow.prototype=new google.maps.OverlayView;b.InfoWindow.prototype.destructor=function(){this.setMap(null);this.vs_map=this.marker=m};b.InfoWindow.prototype.hide=function(){if(this.view)this.view.style.display="none"};b.InfoWindow.prototype.show=function(){if(this.view)this.view.style.display="block"};b.InfoWindow.prototype.setMarker=
function(a){this.marker&&this.unbind("position");this.marker=a;this.id=this.marker.id;this.type=this.marker.type;this.info=this.marker.info;this.bindTo("position",this.marker._gmarker,"position");this.instanciateView(this.type,this.info)};b.InfoWindow.prototype.setCoordinate=function(a,c){this.position&&delete this.position;this.position=new google.maps.LatLng(a,c)};b.InfoWindow.prototype.setType=function(a){this.type=a;this.instanciateView(this.type,this.info)};b.InfoWindow.prototype.setInfo=function(a){this.info=
a;this.instanciateView(this.type,this.info)};b.InfoWindow.prototype.instanciateView=function(a,c){var j=h.createElement("div"),d=b._anotation_templates_[a];d||(d=b._anotation_templates_["default"]);d=d.infoWindow;if(c)for(key in c)var e=c[key],e=e?e:"",d=d.replace("{"+key+"}",e);j.innerHTML=d;this.view||this.createView();this.view.innerHTML=j.firstElementChild.innerHTML;this.view.className=j.firstElementChild.className};b.InfoWindow.prototype.createView=function(){if(!this.view)this.view=h.createElement("div"),
this.view.addEventListener(g.POINTER_START,this)};b.InfoWindow.prototype.handleEvent=function(a){var c=this;switch(a.type){case g.POINTER_START:if(g.EVENT_SUPPORT_TOUCH&&a.touches.length>1)break;h.addEventListener(g.POINTER_END,this);h.addEventListener(g.POINTER_MOVE,this);this.__start_x=g.EVENT_SUPPORT_TOUCH?a.touches[0].pageX:a.pageX;this.__start_y=g.EVENT_SUPPORT_TOUCH?a.touches[0].pageY:a.pageY;this.marker&&this.removeMapEvent();e.addClassName(this.view,"selected");return!1;case g.POINTER_MOVE:if(Math.abs((g.EVENT_SUPPORT_TOUCH?
a.touches[0].pageX:a.pageX)-this.__start_x)+Math.abs((g.EVENT_SUPPORT_TOUCH?a.touches[0].pageY:a.pageY)-this.__start_y)<10)return a.preventDefault(),!1;h.removeEventListener(g.POINTER_END,this);h.removeEventListener(g.POINTER_MOVE,this);this.marker&&setTimeout(function(){c.initMapEvent()},0);e.removeClassName(this.view,"selected");return!1;case g.POINTER_END:return a.stopPropagation(),a.preventDefault(),h.removeEventListener(g.POINTER_END,this),h.removeEventListener(g.POINTER_MOVE,this),this.marker&&
setTimeout(function(){c.initMapEvent()},0),e.removeClassName(this.view,"selected"),this.vs_map.annotationSelect(this.id),!1}};b.InfoWindow.prototype.onAdd=function(){this.view||this.createView();this.getPanes().floatPane.appendChild(this.view);var a=this;this.listeners_=[google.maps.event.addListener(this,"position_changed",function(){a.draw()})]};b.InfoWindow.prototype.onRemove=function(){this.view.parentNode.removeChild(this.view);for(var a=0,c=this.listeners_.length;a<c;++a)google.maps.event.removeListener(this.listeners_[a])};
b.InfoWindow.prototype.draw=function(){var a=this.getProjection().fromLatLngToDivPixel(this.get("position")),c=this.view;c.style.display="block";c.style.visibility="hidden";var b=0;if(this.marker){var b=10,d=this.marker._gmarker.getIcon();d&&(b+=d.size.height)}setTimeout(function(){var d=c.offsetHeight;c.style.left=a.x-Math.ceil(c.offsetWidth/2)+"px";c.style.top=a.y-d-b+"px";c.style.visibility="visible"},0)};b.InfoWindow.prototype.initMapEvent=function(){if(!this.map_listener){var a=this;this.map_listener=
google.maps.event.addListener(this.vs_map._gmap,"click",function(){a.hide()})}};b.InfoWindow.prototype.removeMapEvent=function(){if(this.map_listener)google.maps.event.removeListener(this.map_listener),this.map_listener=m};b.InfoWindowWithMarker=function(a){this.vs_map=a;this.setValues({map:this.vs_map._gmap});this.initMapEvent()};e.extendClass(b.InfoWindowWithMarker,b.InfoWindow)}function k(a){this.parent=f.ui.View;this.parent(a);this.constructor=k;this.__indicators_list={}}var h=n.document,f=n.vs,
e=f.util,g=f.core,l=f.ui,o=f.ext.ui,b=function(a){this.parent=f.ui.View;this.parent(a);this.constructor=b;this._center=[];this._center[0]=48.83763339660763;this._center[1]=2.3397827148437544;if(!b.__google_loaded__){if(!b.__google_wait_loaded__)b.__google_wait_loaded__=!0,f.util.importFile("http://maps.google.com/maps/api/js?sensor=true&callback=vs.ext.ui.GMap.__on_laoded",null,null,"js");b._to_finish_init.push(this)}this.__annotations={}};b.NO_MARKER=0;b.DEVICE_IMAGE_MARKER=1;b.IMAGE_MARKER=2;b._anotation_templates_=
{};b._anotation_templates_["default"]={marker:{type:b.DEVICE_IMAGE_MARKER},infoWindow:'<div class="vs_ext_ui_gmap_info">    <div>{title}</div>    <div>{subtitle}</div>  </div>'};b.__google_wait_loaded__=!1;b.__google_loaded__=!1;b._to_finish_init=[];b.__on_laoded=function(){var a,c;b.__google_loaded__=!0;b.__google_wait_loaded__=!1;p();a=0;for(c=b._to_finish_init.length;a<c;a++)b._to_finish_init[a].finishInit();b._to_finish_init=null};b.prototype={_zoom:10,_tilt:-1,_scroll:!0,_tap_to_zoom:!0,_max_zoom:20,
_min_zoom:1,_zoom_control:!1,_street_view_control:!1,_center:null,_gmap:null,__init_finished:!1,__annotations:null,destructor:function(){delete this._gmap;f.ui.View.prototype.destructor.call(this)},initComponent:function(){f.ui.View.prototype.initComponent.call(this);b.__google_loaded__&&this.finishInit()},finishInit:function(){var a={zoom:this._zoom,center:new google.maps.LatLng(this._center[0],this._center[1]),disableDefaultUI:!0,draggable:this._scroll,maxZoom:this._max_zoom,minZoom:this._min_zoom,
disableDoubleClickZoom:!this._tap_to_zoom,streetViewControl:this._street_view_control,streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},zoomControl:this._zoom_control,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM,style:google.maps.ZoomControlStyle.SMALL},mapTypeControlOptions:{style:google.maps.ControlPosition.HORIZONTAL_BAR},mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};this._gmap=
new google.maps.Map(this.view,a);var c=this;setTimeout(function(){c.__init_did_finish()},0)},__init_did_finish:function(){this.__init_finished=!0;this.streetViewControl=this._street_view_control;this.zoomControl=this._zoom_control;this.propagate("mapload")},isReady:function(){return this.__init_finished},getGoogleMapObject:function(){return this._gmap},showCenterMark:function(){if(!this._center_mark)this._center_mark=new google.maps.Marker({position:new google.maps.LatLng(this._center[0],this._center[1]),
icon:"mapCenter.png"});this._center_mark.setGMap(this._gmap)},hideCenterMark:function(){this._center_mark&&this._center_mark.setGMap(null)},addAnnotation:function(a,c,j,d,f){if(this.__init_finished){if(!e.isString(a)||!a)a=g.createId();c=new b.Annotation(this,a,c,j,d,f);return this.__annotations[a]=c}},setAnnotationTemplate:function(a,c,j){if(e.isString(a)||a){var d=b._anotation_templates_["default"];b._anotation_templates_[a]={marker:e.clone(c?c:d.marker),infoWindow:e.clone(j?j:d.infoWindow)}}},
removeAnnotation:function(a){if(!e.isString(a)&&a.id)a=a.id;var c=this.__annotations[a];c&&(e.free(c),delete this.__annotations[a])},removeAnnotations:function(){for(var a in this.__annotations)this.removeAnnotation(a)},annotationSelect:function(a){this.propagate("annotationselect",a)}};e.extendClass(b,f.ui.View);e.defineClassProperties(b,{scroll:{set:function(a){this._scroll=a?!0:!1;this.__init_finished&&this._gmap.setOptions({draggable:this._scroll})},get:function(){return this._scroll}},tapToZoom:{set:function(a){this._tap_to_zoom=
a?!0:!1;this.__init_finished&&this._gmap.setOptions({disableDoubleClickZoom:!this._tap_to_zoom})},get:function(){return this._tap_to_zoom}},maxZoom:{set:function(a){if(f.util.isNumber(a))this._max_zoom=a,this.__init_finished&&this._gmap.setOptions({maxZoom:this._max_zoom})},get:function(){return this._max_zoom}},minZoom:{set:function(a){if(f.util.isNumber(a))this._min_zoom=a,this.__init_finished&&this._gmap.setOptions({maxZoom:this._min_zoom})},get:function(){return this._min_zoom}},zoomControl:{set:function(a){this._zoom_control=
a?!0:!1;this.__init_finished&&this._gmap.setOptions({zoomControl:this._zoom_control})},get:function(){return this._zoom_control}},zoom:{set:function(a){if(f.util.isNumber(a)&&this.__init_finished&&(a=Math.floor(a),a!==this._zoom))this._zoom=a,this._gmap.setZoom(this._zoom)},get:function(){if(!this._gmap)return-1;return this._zoom=this._gmap.getZoom()}},tilt:{set:function(a){if(f.util.isNumber(a)&&this.__init_finished)this._tilt=a,this._gmap.setTilt(a)},get:function(){if(!this._gmap)return-1;return this._tilt=
this._gmap.getTilt()}},streetViewControl:{set:function(a){this._street_view_control=a?!0:!1;this.__init_finished&&this._gmap.setOptions({streetViewControl:this._street_view_control})},get:function(){return this._street_view_control}},center:{set:function(a){this.__init_finished&&a&&f.util.isArray(a)&&a.length===2&&f.util.isNumber(a[0])&&f.util.isNumber(a[1])&&(this._center[0]=a[0],this._center[1]=a[1],a=new google.maps.LatLng(a[0],a[1]),this._gmap.setCenter(a),this._center_mark&&this._center_mark.setPosition(a))},
get:function(){if(!this._gmap)return[0,0];var a=this._gmap.getCenter();this._center[0]=a.lat();this._center[1]=a.lng();return this._center.slice()}}});b.Annotation=function(a,c,j,d,e,g){this.map=a;this.id=c;this.info=e;this.type=g?g:"default";this._coordinate=new google.maps.LatLng(j,d);var h=b._anotation_templates_[this.type];h||(h=b._anotation_templates_["default"]);this.image=null;if(h.marker.type==b.DEVICE_IMAGE_MARKER)h=n.deviceConfiguration.os,this.image=h==f.core.DeviceConfiguration.OS_SYMBIAN?
new google.maps.MarkerImage("css/kit/symbian_marker.png",new google.maps.Size(48,51),new google.maps.Point(0,0),new google.maps.Point(24,48)):h==f.core.DeviceConfiguration.OS_WP7?new google.maps.MarkerImage("css/kit/wp7_marker.png",new google.maps.Size(15,31),new google.maps.Point(0,0),new google.maps.Point(0,31)):new google.maps.MarkerImage("css/kit/ios_marker.png",new google.maps.Size(32,41),new google.maps.Point(0,0),new google.maps.Point(8,36));else if(h.marker.type==b.IMAGE_MARKER)this.image=
new google.maps.MarkerImage(h.marker.url);if(this.image){this._gmarker=new google.maps.Marker({position:this._coordinate,icon:this.image,map:a._gmap,animation:google.maps.Animation.DROP});var i=this;google.maps.event.addListener(this._gmarker,"click",function(){i.onselect()})}else this._infoWindow=new b.InfoWindow(this.map,c,j,d,g),this._infoWindow.setCoordinate(j,d),this._infoWindow.setInfo(e)};b.Annotation.prototype={destructor:function(){this._gmarker&&(this._gmarker.setMap(null),delete this._gmarker);
this._infoWindow&&free(this._infoWindow);this.image&&delete this.image;delete this._coordinate;this.map=m},onselect:function(){this.showInfoWindow()},showInfoWindow:function(){if(!this.map._infoWindow)this.map._infoWindow=new b.InfoWindowWithMarker(this.map);this.map._infoWindow.setMarker(this)}};e.defineClassProperties(b.Annotation,{coordinate:{set:function(a){if(e.isArray(a)||a.length==2)delete this._coordinate,this._coordinate=new google.maps.LatLng(a[0],a[1]),this._gmarker&&this._gmarker.setPosition(this._coordinate)},
get:function(){return[this._coordinate.lat(),this._coordinate.lng()]}},info:{set:function(a){this._info=a;this._infoWindow&&this._infoWindow.setInfo(a)},get:function(){return this._info}}});o.GMap=b;k.HORIZONTAL=f.fx.SlideController.HORIZONTAL;k.VERTICAL=f.fx.SlideController.VERTICAL;k.prototype={_indicators_visibility:!0,_delegate:null,_orientation:k.HORIZONTAL,_slideController:null,__indicators:null,__selected_indicator:null,__indicators_list:null,__indicators_timer:0,destructor:function(){e.free(this._slideController);
f.ui.View.prototype.destructor.call(this)},initComponent:function(){f.ui.View.prototype.initComponent.call(this);this._slideController=new f.fx.SlideController(this);this._slideController.delegate=this;this._slideController.isTactile=!0;this.__indicators=this.view.querySelector(".vs_ext_ui_carousel >.indicators");f.util.addClassName(this.__indicators,"horizontal");this._slideController.init()},refresh:function(){this._slideController&&this._slideController.refresh&&this._slideController.refresh();
f.ui.View.prototype.refresh.call(this)},controllerViewWillChange:function(a,c){this.__indicators_timer&&(clearTimeout(this.__indicators_timer),__indicators_timer=0);var b=c.id,d=this;this.__indicators_timer=setTimeout(function(){d.__selected_indicator&&f.util.removeClassName(d.__selected_indicator,"selected");d.__selected_indicator=d.__indicators_list[b];f.util.addClassName(d.__selected_indicator,"selected")},500);this._delegate&&this._delegate.carouselViewWillChange&&this._delegate.carouselViewWillChange(c)},
add:function(a){f.ui.View.prototype.add.call(this,a,"children");this.push(a)},push:function(a,c){if(!this.isChild(a)||!this._slideController.isStateExit(a.id)){var b,d=this._slideController.push(a,c);b=h.createElement("span");this.__indicators.appendChild(b);this.__indicators_list[d]=b}},remove:function(a){a&&a.id&&(this.__indicators.removeChild(this.__indicators_list[a.id]),delete this.__indicators_list[a.id],f.ui.View.prototype.remove.call(this,a))},removeAllChildren:function(){for(var a in this.__indicators_list)this.remove(f.core.Object._obs[a])},
goToNextView:function(){this._slideController.goToNextView()},goToPreviousView:function(){this._slideController.goToPreviousView()},goToView:function(a){this._slideController.goToViewId(a)},goToViewAt:function(a){this._slideController.goToViewAt(a)}};e.extendClass(k,f.ui.View);e.defineClassProperties(k,{size:{set:function(a){a&&e.isArray(a)&&a.length===2&&e.isNumber(a[0])&&e.isNumber(a[1])&&(this._size[0]=a[0],this._size[1]=a[1],this.view&&(this._updateSize(),this._slideController&&this._slideController.refresh&&
this._slideController.refresh()))},get:function(){var a=this.view;if(a&&a.parentNode)this._size[0]=a.offsetWidth,this._size[1]=a.offsetHeight;return this._size.slice()}},delegate:{set:function(a){this._delegate=a}},indicatorsVisibility:{set:function(a){a?(this._indicators_visibility=!0,__setVisible(this.__indicators,!0)):(this._indicators_visibility=!1,__setVisible(this.__indicators,!1))}},orientation:{set:function(a){if(!(a!==k.HORIZONTAL&&a!==k.VERTICAL)&&this._orientation!==a)a===k.HORIZONTAL?
(f.util.removeClassName(this.__indicators,"vertical"),f.util.addClassName(this.__indicators,"horizontal")):(f.util.removeClassName(this.__indicators,"horizontal"),f.util.addClassName(this.__indicators,"vertical")),this._orientation=a,this._slideController.orientation=a},get:function(){return this._orientation}}});o.Carousel=k;var i=function(a){this.parent=l.View;this.parent(a);this.constructor=i;this.__ab_a_items=[]};i.STRETCH_NONE=0;i.STRETCH_FILL=1;i.prototype={_stretch:i.STRETCH_NONE,__ab_a_items:m,
__ab_a_current_index:m,__ab_a_head_height:33,push:function(a,c){a&&(this.add(a),this.setPanelTitle(this._getIndexForChild(a),c))},add:function(a){if(a){var c;if(!a.id)a.id=f.core.createId();c=this.__ab_a_items.length;c=this._createView(a,"Section "+(c+1),c);this.view.appendChild(c.dt);l.View.prototype.add.call(this,a,"children",c.dd);this.__ab_a_items.push(c);this._updateSizePanel()}},remove:function(a){var c=this._getIndexForChild(a),b;if(c!==-1)l.View.prototype.remove.call(this,a),b=this.__ab_a_items[c],
b.dd.removeChild(a.view),this.view.removeChild(b.dt),b.dt.removeEventListener(g.POINTER_START,this),delete b.dt,delete b.dd,delete b,this.__ab_a_items.remove(c),c===this.__ab_a_current_index?(this.__ab_a_current_index=null,this.expandPanel(0)):this._updateSizePanel()},_getIndexForChild:function(a){if(!a)return-1;var c,b;for(c=0;c<this.__ab_a_items.length;c++)if((b=this.__ab_a_items[c])&&b.dd&&b.dd.__child===a)return c;return-1},_createView:function(a,c,b){var d={};d.dt=h.createElement("dt");e.setElementInnerText(d.dt,
c);d.title=c;d.dd=h.createElement("dd");if(this._stretch===i.STRETCH_FILL)a.position=[0,0];d.dd.appendChild(a.view);c=b?"collapsed":"expanded";d.dd.setAttribute("class",c);d.dt.setAttribute("class",c);d.dd.__child=a;d.child=a;c==="collapsed"?(d.dd.style.width="100%",d.dd.style.height="0px"):(d.dd.style.width="100%",d.dd.style.height=a._size[1]+"px",this.__ab_a_current_index=b);if(this._stretch===i.STRETCH_FILL)a.size=[this._size[0]-2,this._size[1]];d.dt.__dd=d.dd;d.dt.__index=b;d.dt.addEventListener(g.POINTER_START,
this);return d},expandPanel:function(a){var c,b;if(e.isNumber(a)&&a>=0&&a<this.__ab_a_items.length){if(a!==this.__ab_a_current_index){if(c=this.__ab_a_items[this.__ab_a_current_index])e.removeClassName(c.dt,"expanded"),e.addClassName(c.dt,"collapsed"),c.dd.style.height="0px";c=this.__ab_a_items[a];e.removeClassName(c.dt,"collapsed");e.addClassName(c.dt,"expanded");this.__ab_a_current_index=a;this._updateSizePanel();this.propagate("panel_select",a)}}else if(e.isString(a))for(b=0;b<this.__ab_a_items.length;b++)if(c=
this.__ab_a_items[b],c.title===a){this.expandPanel(b);break}},setPanelTitle:function(a,c){var b,d;if(e.isNumber(a)&&a>=0&&a<this.__ab_a_items.length)b=this.__ab_a_items[a],b.title=c,e.setElementInnerText(b.dt,c);else if(e.isString(a))for(d=0;d<this.__ab_a_items.length;d++)if(b=this.__ab_a_items[d],b.title===a){this.setPanelTitle(d,c);break}},_updateSize:function(){f.ui.View.prototype._updateSize.call(this);this._updateSizePanel()},_updateSizePanel:function(){var a,b;if(b=this.__ab_a_items[this.__ab_a_current_index])if(a=
this._size[1],this.__ab_a_head_height=b.dt.offsetHeight,a-=this.__ab_a_items.length*this.__ab_a_head_height+8,b.dd.style.height=a+"px",this._stretch===i.STRETCH_FILL)b.child.size=[this._size[0]-2,a]},handleEvent:function(a){var b=a.target,f=this;if(b.nodeType!==1)b=b.parentElement;if(a.type===g.POINTER_START){if(EVENT_SUPPORT_TOUCH&&a.touches.length>1)return;a.stopPropagation();a.preventDefault();if(e.hasClassName(b,"expanded"))return!1;h.addEventListener(g.POINTER_MOVE,this,!1);h.addEventListener(g.POINTER_END,
this,!1);this.__touch_start_x=EVENT_SUPPORT_TOUCH?a.touches[0].pageY:a.pageY;this.__touch_start_y=EVENT_SUPPORT_TOUCH?a.touches[0].pageY:a.pageY;this.__elem=b;if(this.__elem_to_unselect)e.removeClassName(this.__elem_to_unselect,"selected"),this.__elem_to_unselect=null;this.__list_time_out=setTimeout(function(){e.addClassName(f.__elem,"selected");f.__list_time_out=0},l.View.SELECT_DELAY)}else if(a.type===g.POINTER_MOVE){if(a.stopPropagation(),a.preventDefault(),b=EVENT_SUPPORT_TOUCH?a.touches[0].pageX:
a.pageX,a=EVENT_SUPPORT_TOUCH?a.touches[0].pageY:a.pageY,a=Math.abs(a-this.__touch_start_y)+Math.abs(b-this.__touch_start_x),this.__elem&&a>l.View.MOVE_THRESHOLD*2)this.__list_time_out?(clearTimeout(this.__list_time_out),this.__list_time_out=0):e.removeClassName(this.__elem,"selected"),this.__elem=null}else if(a.type===g.POINTER_END){a.stopPropagation();a.preventDefault();h.removeEventListener(g.POINTER_MOVE,this);h.removeEventListener(g.POINTER_END,this);if(this.__elem)this.__list_time_out&&(clearTimeout(this.__list_time_out),
e.addClassName(f.__elem,"selected")),this.__elem_to_unselect=this.__elem,this.__list_time_out=setTimeout(function(){e.removeClassName(f.__elem_to_unselect,"selected");f.__elem_to_unselect=null;f.__list_time_out=0},l.View.UNSELECT_DELAY),e.isNumber(b.__index)&&this.expandPanel(b.__index);this.__elem=null}return!1},notify:function(){}};e.extendClass(i,f.ui.View);e.defineClassProperty(i,"stretch",{set:function(a){if(e.isNumber(a)&&!(a!==i.STRETCH_FILL&&a!==i.STRETCH_NONE))this._stretch=a,this._stretch===
i.STRETCH_FILL?e.addClassName(this.view,"fill"):e.removeClassName(this.view,"fill"),this._updateSizePanel()},get:function(){return this._stretch}});o.Accordion=i;b.prototype.html_template="<div class='vs_ext_ui_gmap'></div>";k.prototype.html_template="<div class='vs_ext_ui_carousel' x-hag-hole='children'><div class='indicators'></div></div>";i.prototype.html_template="<dl class='vs_ext_ui_accordion' x-hag-hole='children'></dl>"})(window);
